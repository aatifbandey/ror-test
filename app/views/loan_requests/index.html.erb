
<div class="layout">
    <div class="form-wrap">
    
        <div>
            <div class="title"> Apply for Loan </div>
            <form action="/loan_requests" onSubmit="submitForm(event)" accept-charset="UTF-8" method="post" class="form">
                <div class="flex-col" >
                    <div class="row">
                    <label>Name: </label>  <input class="input-box validation" name="loan_request[name]" id="name" type="text" />
                    </div>  
                    <div class="row">
                    <label>Email:</label> <input class="input-box validation" name="loan_request[email]" id="email" type="text" />
                    </div>
                    <div class="row">
                    <label>Phone: </label> <input class="input-box validation" name="loan_request[phone]" id="phone" type="text" />
                
                    </div>
                    <div class="row error-msg-phone">
                        <span >Phone number to be a number</span>
                    </div>
                    <div class="row stage-2">
                    <label>Loan Amount: </label>  <input class="input-box validation" name="loan_request[loanAmount]" id="amount" type="text" />
                    </div>  
                    <div class="row error-msg-loan">
                        <span >Loan Amount should be number and greater than zero</span>
                    </div>
                    <div class="row stage-2">
                        <label>College Name:</label> <input class="input-box validation" name="loan_request[collegeName]" id="college_name" type="text" />
                    </div>
                    <div class="row error-msg-colg-name">
                        <span >Enter your college name</span>
                    </div>
                </div>
                
                <div class="btn-wrap">
                    <button class="primary-btn" id="next-btn" disabled> Next </button>
                </div>
            </form>
            
        </div>
    </div>
    <div id="requests" class="table-wrap">
        <table>
            <thead>
                <tr>
                <th> 
                    Requester Name
                    </th>
                    <th>
                    Email
                    </th> 
                    <th>
                    Phone
                    </th>
                    <th>
                    Amount
                    </th>
                    <th>
                    College Name
                    </th>
                </tr>
            </thead>
        <tbody>
            <% @loan_requests.each do |loan_request| %>
    
                <tr>
                <td> 
                    <%= loan_request.name %>
                
                    </td>
            
                <td> 
                    <%= loan_request.email %>
                    
                    </td>
            
                <td> 
                    <%= loan_request.phone %>
                    
                    </td>
                    <td> 
                    <%= loan_request.loanAmount %>
                    
                    </td>
                    <td> 
                    <%= loan_request.collegeName %>
                    
                    </td>
                </tr>
            
        <% end %>
    
    </tbody>
    </table>
            
    </div>
</div>


<script>
    const nameInput = document.getElementById("name");
    const emailInput = document.getElementById("email");
    const phoneInput = document.getElementById("phone");
    const nextButton = document.getElementById("next-btn");
    const stageTwoElems = document.querySelectorAll('.stage-2');

    const inputBoxes = document.querySelectorAll('.validation');

    inputBoxes.forEach(function(inputElement) {
   
        inputElement.addEventListener('input', function() {
            if (nameInput && nameInput.value.trim() !== "" && emailInput.validity.valid && emailInput.value.trim() !== "" &&
            phoneInput && phoneInput.value.trim() !== "") {
            nextButton.disabled = false;
        
            nextButton.style.backgroundColor = '#196df2';
          
            enableTextBox();
            
            } else {
                nextButton.style.backgroundColor = 'grey';
                nextButton.disabled = true;
            }
        });

    
    });
    function enableTextBox() {
        stageTwoElems.forEach(function(inputElem) {
            inputElem.style.display = 'flex';
        })
    }
    function submitForm(e) {
      
        const phoneInput = document.getElementById("phone").value;
        const amount = document.getElementById("amount").value;
        const college_name = document.getElementById('college_name').value;

     
        if(phoneInput && (isNaN(phoneInput) || phoneInput.length < 10 || phoneInput.length > 15)) {
            document.querySelectorAll('.error-msg-phone')[0].style.display = 'flex';
            e.preventDefault()
           
        } else {
            document.querySelectorAll('.error-msg-phone')[0].style.display = 'none';
        }
        // const convAmt = Number(amount)
        if(amount && (isNaN(amount) || !amount.length )) {
            document.querySelectorAll('.error-msg-loan')[0].style.display = 'flex';
            e.preventDefault()
           
        } else {
            document.querySelectorAll('.error-msg-loan')[0].style.display = 'none';
        }

        if(!college_name) {
            document.querySelectorAll('.error-msg-colg-name')[0].style.display = 'flex';
            e.preventDefault()
           
        } else {
            document.querySelectorAll('.error-msg-colg-name')[0].style.display = 'none';
        }
        
        console.log("test");
    }
</script>
